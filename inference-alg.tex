\begin{algorithm} 
\caption[max-sum inference]{Max-sum message passing to solve 
$$\argmax_{y \in \cY} s(x,y) = \argmax \sum_{i \in \cV} \phi_i + \sum_{ij \in \cE} \phi_{ij}$$} 
\label{alg:max-inference} 
\begin{algorithmic} 

\REQUIRE $ $ \\ 
Factors $\{\phi_i\}, \{\phi_{ij}\}$\\
Tree graph $G$ with (arbitrary) root node index $r$ and topological ordering $\pi$, where $\pi_n = r$.

\ENSURE $y^\star = \argmax_{y} s(x,y)$ 
\FOR{$i = \pi_1, \pi_2, \ldots, \pi_n $ }
\STATE
$m_i = \phi_i + \sum_{j \in \text{kids}(i)} m_{j \rightarrow i}$
\IF{$i == r$} \STATE \textbf{break} \ENDIF
\STATE
$p = \texttt{parent}_\pi(i) $
\STATE
$m_{i \rightarrow p} = \max_{y_i} \phi_{ip} + m_i$
\STATE
$a_i = \argmax_{y_i} \phi_{ip} + m_i$
\ENDFOR

\STATE
$y^\star_r = \argmax m_r$
\FOR{$i = \pi_{n-1},\pi_{n-2},\ldots,1$}
\STATE $y^\star_i = a_i\left[y^\star_{\texttt{parent}_\pi(i)}\right]$
\ENDFOR

\end{algorithmic} 
\end{algorithm}

